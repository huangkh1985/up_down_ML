# 双模型系统对比说明

## 🎯 系统架构一览

```
┌─────────────────────────────────────────────────────────────┐
│              股票预测系统 - 双模型架构                          │
└─────────────────────────────────────────────────────────────┘
                          │
          ┌───────────────┴───────────────┐
          │                               │
          ▼                               ▼
┌──────────────────────┐        ┌──────────────────────┐
│   MA20状态预测模型    │        │  形态反转信号预测模型  │
├──────────────────────┤        ├──────────────────────┤
│ 预测目标:             │        │ 预测目标:             │
│ 收盘价 vs MA20       │        │ 形态反转信号          │
│                      │        │                      │
│ 算法: XGBoost        │        │ 算法: RandomForest   │
│                      │        │                      │
│ 模型数: 4个独立       │        │ 模型数: 4个独立       │
│ (1天/3天/5天/10天)   │        │ (1天/3天/5天/10天)   │
│                      │        │                      │
│ 训练脚本:             │        │ 训练脚本:             │
│ train_ma20_multi_    │        │ multi_horizon_       │
│ horizon.py           │        │ prediction_system.py │
│                      │        │                      │
│ 模型文件:             │        │ 模型文件:             │
│ ma20_multi_horizon_  │        │ multi_horizon_       │
│ models.pkl           │        │ models.pkl           │
└──────────────────────┘        └──────────────────────┘
          │                               │
          └───────────────┬───────────────┘
                          ▼
              ┌───────────────────────┐
              │   Streamlit Web应用    │
              │                       │
              │ Tab 1: MA20预测       │
              │ Tab 2: 形态信号预测    │
              └───────────────────────┘
```

---

## 📊 核心差异对比

### 预测内容

| 模型 | 预测问题 | 预测结果示例 |
|-----|---------|------------|
| **MA20模型** | "明天股价会在MA20之上还是之下？" | "1天后：强势(≥MA20)，置信度89%" |
| **形态模型** | "未来会出现看涨/看跌反转形态吗？" | "3天后：看涨反转信号，置信度65%" |

### 使用场景

```
MA20模型适用于:
✓ 判断股票当前趋势强弱
✓ 确定支撑/阻力位
✓ 趋势跟踪策略
✓ 风险管理（相对MA20的位置）

形态模型适用于:
✓ 捕捉趋势反转点
✓ 寻找买卖时机
✓ 确认底部/顶部
✓ 波段交易策略
```

---

## 🎨 在Streamlit中的呈现

### 界面布局
```
┌──────────────────────────────────────────────┐
│          股票预测分析系统                      │
├──────────────────────────────────────────────┤
│ 侧边栏:                                       │
│  [输入] 股票代码: 002104                      │
│  [选择] 预测方法: 🔄 两种方法对比             │
│  [按钮] 开始分析                              │
└──────────────────────────────────────────────┘

主界面 - 标签页:

┌─────────────┬─────────────┬─────────────┐
│  MA20预测   │  形态信号    │   综合决策   │
└─────────────┴─────────────┴─────────────┘

【MA20预测标签页】
─────────────────────────────────────────
使用独立ML模型-1天 vs 规则方法

时间窗口 | ML预测 | 规则预测 | 差异
---------|--------|---------|-----
1天      | 强势89%| 强势65% | ↑
3天      | 强势75%| 强势63% | ↑
5天      | 弱势52%| 强势61% | ↓
10天     | 弱势49%| 弱势55% | 一致

【形态信号标签页】
─────────────────────────────────────────
时间窗口 | 信号类型 | 置信度
---------|---------|-------
1天      | 看涨反转 | 68%
3天      | 看涨反转 | 55%
5天      | 无明显   | 48%
10天     | 无明显   | 43%
```

---

## 🔄 完整训练流程

### 快速版本（一键）
```bash
retrain_all_models_complete.bat
```

### 详细版本（分步骤）

```bash
# ===== 步骤1: 准备工作 =====
# 备份现有模型
mkdir models\backup_20251005
copy models\*.pkl models\backup_20251005\

# ===== 步骤2: 更新数据 =====
python stock_data_downloader.py
# 输出: 28只股票，最新日期2025-10-05

# ===== 步骤3: 训练MA20模型 =====
python train_ma20_multi_horizon.py
# 耗时: 1-2分钟
# 输出: models/ma20_multi_horizon_models.pkl
# 结果:
#   1天准确率: 89.58%
#   3天准确率: 83.49%
#   5天准确率: 79.58%
#   10天准确率: 77.98%

# ===== 步骤4: 训练形态识别模型 =====
python multi_horizon_prediction_system.py
# 耗时: 1-3分钟
# 输出: models/multi_horizon_models.pkl
# 结果:
#   1天准确率: 68.23%
#   3天准确率: 65.41%
#   5天准确率: 64.23%
#   10天准确率: 62.01%

# ===== 步骤5: 验证所有模型 =====
python validate_all_models.py
# 检查: 8个模型（MA20×4 + 形态×4）
# 输出: 全部通过 ✓

# ===== 步骤6: 测试应用 =====
streamlit run app_streamlit.py
# 测试股票: 002104
# 检查两个标签页的预测结果
```

---

## 📈 准确率标准

### MA20模型（核心指标）

| 时间窗口 | 最低 | 良好 | 优秀 | 当前基准 |
|---------|-----|------|------|---------|
| 1天 | 75% | 80% | 85% | **89.58%** ⭐ |
| 3天 | 70% | 75% | 80% | **83.49%** ⭐ |
| 5天 | 65% | 72% | 78% | **79.58%** ⭐ |
| 10天 | 60% | 68% | 75% | **77.98%** ⭐ |

### 形态识别模型（辅助指标）

| 时间窗口 | 最低 | 良好 | 优秀 |
|---------|-----|------|------|
| 1天 | 60% | 65% | 70% |
| 3天 | 58% | 62% | 68% |
| 5天 | 55% | 60% | 65% |
| 10天 | 52% | 58% | 63% |

**注意：** 形态识别准确率较低是正常的，因为反转信号是稀有事件。

---

## 💡 应该训练哪个模型？

### 场景1: 新数据到来
**答案：训练两个模型**
```bash
retrain_all_models_complete.bat
```

### 场景2: MA20预测不准确
**答案：仅训练MA20模型**
```bash
python train_ma20_multi_horizon.py
python validate_models.py
```

### 场景3: 形态信号不准确
**答案：仅训练形态识别模型**
```bash
python multi_horizon_prediction_system.py
python validate_all_models.py
```

### 场景4: 定期维护（每月）
**答案：训练两个模型**
```bash
retrain_all_models_complete.bat
```

---

## 🎯 重点提醒

### ✅ 必须做的
1. **训练前备份** - 防止新模型效果不好
2. **更新数据** - 确保数据包含最新交易日
3. **验证模型** - 检查准确率是否合理
4. **测试应用** - 在Streamlit中测试3个股票

### ⚠️ 注意事项
1. **MA20模型是核心** - 必须保证其质量
2. **形态模型是辅助** - 可以单独更新
3. **两个模型独立** - 可以分别训练，互不影响
4. **准确率会波动** - 5%以内的波动是正常的

### ❌ 不要做的
1. **不备份直接训练** - 万一需要回滚
2. **不验证直接部署** - 可能影响预测质量
3. **只看准确率** - 还要看精确率、召回率
4. **长期不更新** - 建议每月更新一次

---

## 📚 文档索引

### 快速参考
- `QUICK_RETRAIN_REFERENCE.md` - 一页速查表
- `TWO_MODEL_SYSTEMS_COMPARISON.md` - 本文档

### 详细指南
- `COMPLETE_RETRAINING_GUIDE.md` - 完整训练指南
- `MODEL_RETRAINING_GUIDE.md` - MA20模型详细说明
- `MA20_MULTI_MODEL_UPGRADE.md` - MA20技术升级说明

### 使用手册
- `MA20_DUAL_METHOD_GUIDE.md` - MA20双方法使用
- `STREAMLIT_QUICK_START.md` - Streamlit应用指南

---

## 🚀 快速开始

**第一次使用？**
```bash
# 一键训练所有模型
retrain_all_models_complete.bat

# 启动应用
streamlit run app_streamlit.py

# 测试股票代码: 002104, 002165, 301357
```

**定期维护？**
```bash
# 每月运行一次
retrain_all_models_complete.bat
```

**出现问题？**
```bash
# 回滚到上一版本
rollback_models.bat
```

---

**文档版本：** 1.0.0  
**最后更新：** 2025-10-05  
**适用系统：** Windows 10/11

