# Streamlit 时间段选择功能说明

## 🎯 功能概述

现在Streamlit应用已支持**自定义股票数据时间段**选择功能，让用户可以灵活地选择分析的历史数据范围。

## 📅 主要功能

### 1. 快速时间段选择
在侧边栏提供了6个快捷按钮，可以一键设置常用的时间范围：
- **近1月**：最近1个月的数据
- **近3月**：最近3个月的数据（推荐用于短期分析）
- **近6月**：最近6个月的数据（推荐用于中期分析）
- **近1年**：最近1年的数据（推荐用于长期分析）
- **近2年**：最近2年的数据
- **2024至今**：从2024年1月1日到今天

### 2. 自定义日期选择
提供两个日期选择器，可以精确设置：
- **开始日期**：数据的起始日期（最早2020年）
- **结束日期**：数据的截止日期（最晚今天）

### 3. 数据跨度显示
实时显示选择的时间跨度信息：
- 显示总天数和月数
- 当数据少于60天时，会提示建议选择至少2个月的数据

### 4. 智能验证
- 自动验证日期有效性（开始日期必须早于结束日期）
- 显示错误提示，防止无效选择

## 🔧 技术实现

### 核心修改点

1. **get_stock_data 方法更新**
   ```python
   def get_stock_data(_self, stock_code, start_date='20240101', end_date='20250930'):
   ```
   - 新增 `start_date` 和 `end_date` 参数
   - 默认值为2024年至今

2. **侧边栏UI组件**
   - 使用 `st.date_input` 创建日期选择器
   - 使用 `st.session_state` 管理日期状态
   - 使用 `st.rerun()` 实现快速按钮的即时更新

3. **缓存优化**
   - `@st.cache_data(ttl=3600)` 装饰器确保相同参数的查询会被缓存1小时
   - 不同的时间段会分别缓存，提高响应速度

## 📊 使用流程

1. **打开Streamlit应用**
   ```bash
   streamlit run app_streamlit.py
   ```

2. **选择时间段**
   - 在左侧边栏找到"📅 数据时间段选择"区域
   - 点击快速选择按钮，或手动选择日期

3. **输入股票代码**
   - 在主界面输入6位股票代码

4. **开始预测**
   - 点击"🚀 开始预测"按钮
   - 系统会根据选择的时间段获取数据并进行分析

## 💡 使用建议

### 时间段选择建议

- **短期交易（1-3天预测）**：建议选择近3-6个月数据
- **中期交易（5天预测）**：建议选择近6个月-1年数据
- **长期投资（10天预测）**：建议选择近1-2年数据

### 数据量要求

- **最少要求**：至少60天（2个月）数据
- **推荐数量**：90-180天（3-6个月）数据
- **最佳效果**：180-365天（6个月-1年）数据

### 注意事项

1. **数据充足性**：数据越多，技术指标计算越准确
2. **市场环境**：选择包含不同市场环境的数据更有代表性
3. **计算时间**：数据越多，首次加载可能稍慢（但有缓存优化）

## 🎨 界面展示

主要界面元素：

```
侧边栏
├── 📅 数据时间段选择
│   ├── 快速选择（6个按钮）
│   ├── 开始日期选择器
│   ├── 结束日期选择器
│   └── 数据跨度信息
├── ⚙️ 预测方法
└── 📖 使用说明
```

## 🔄 更新内容

### 版本更新记录

**v2.0 - 2025-10-05**
- ✅ 新增时间段选择功能
- ✅ 新增6个快速时间段按钮
- ✅ 新增数据跨度实时显示
- ✅ 新增日期验证和智能提示
- ✅ 优化数据缓存机制
- ✅ 改进用户界面和交互体验

## 📝 技术细节

### Session State 管理
```python
if 'date_range' not in st.session_state:
    st.session_state.date_range = {
        'start': datetime(2024, 1, 1),
        'end': datetime.now()
    }
```

### 日期格式转换
```python
start_date_str = st.session_state.date_range['start'].strftime('%Y%m%d')
end_date_str = st.session_state.date_range['end'].strftime('%Y%m%d')
```

### 数据获取
```python
stock_data = predictor.get_stock_data(stock_code, start_date_str, end_date_str)
```

## 🚀 性能优化

1. **缓存机制**：相同股票代码+时间段的查询会被缓存1小时
2. **按需加载**：只下载用户选择的时间段数据
3. **快速响应**：Session State确保UI状态持久化

## 📧 反馈与支持

如果您在使用过程中遇到任何问题或有改进建议，欢迎反馈！

---

**最后更新**：2025-10-05  
**适用版本**：Streamlit v2.0+
